from supabase import create_client, Client

# Supabaseのclientなどの設定が必要です！
# 事前に変数user_id_textにcharacter table登録済のuser情報を格納する必要あり！

# Supabaseからユーザーのキャラクターデータを取得
response = supabase.table("character").select("*").eq("user_id_text", user_id_text).execute()

if response.data and len(response.data) > 0:
    row = response.data[0]
    # キャラクター名を取得
    character_name = row.get("character_name", "はじまりの卵")

    st.markdown(
        f"""
        <h1 style='text-align: center; font-size: 2.2rem; line-height: 1.2; margin-bottom: 0.5em;'>
            {character_name}
        </h1>
        """,
    unsafe_allow_html=True
    )
    # 画像URL
    monster_url = row.get(
        "image_URL",
        "https://wmcppeiutkzrxrgwguvm.supabase.co/storage/v1/object/public/material/default_monster.png"
    )
else:
    st.error("該当ユーザーが見つかりません")
    row = {}
    monster_url = "https://wmcppeiutkzrxrgwguvm.supabase.co/storage/v1/object/public/material/default_monster.png"

frame_url = "https://wmcppeiutkzrxrgwguvm.supabase.co/storage/v1/object/public/material/monster_flame.png"


# 画像表示
st.markdown(
    f"""
    <div style="position:relative; width:100%; max-width:600px; aspect-ratio:1/1; margin:auto; overflow:hidden;">
        <img src="{frame_url}" style="width:100%; height:100%; position:absolute; top:0; left:0; z-index:2;">
        <img src="{monster_url}" style="width:80%; height:80%; object-fit:contain; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); z-index:3;">
    </div>
    """,
    unsafe_allow_html=True
)